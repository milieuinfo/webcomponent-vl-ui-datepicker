<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <script type="module" src="../vl-datepicker.src.js"></script>
</head>

<body>
<test-fixture id="vl-datepicker-fixture">
  <template>
    <vl-datepicker></vl-datepicker>
  </template>
</test-fixture>

<script>
  suite('<vl-datepicker>', () => {

    const eventEmitted = (component, eventName) => {
      return new Promise((resolve, reject) => {
        const listener = () => {
          component.removeEventListener(eventName, listener);
          resolve();
        };
        component.addEventListener(eventName, listener)
      });
    };

    setup(async () => {
      this.datepicker = fixture('vl-datepicker-fixture');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
    });

    test('bestaat', () => {
      assert.isTrue(typeof this.datepicker !== 'undefined');
    });

    test('opent flatpickr picker', () => {
      this.datepicker._picker.open();
      assert.isTrue(this.datepicker._picker.isOpen);
    });

    test('is standaard in het nederlands; kan optioneel in het Engels, Frans en Duits worden gezet',
        async () => {
          assert.isTrue(this.datepicker._picker.config.locale === "nl");

          this.datepicker.setAttribute('locale', 'en');
          await eventEmitted(this.datepicker, 'vl-datepicker-created');
          assert.isTrue(this.datepicker._picker.config.locale === "en");

          this.datepicker.setAttribute('locale', 'fr');
          await eventEmitted(this.datepicker, 'vl-datepicker-created');
          assert.isTrue(this.datepicker._picker.config.locale === "fr");

          this.datepicker.setAttribute('locale', 'de');
          await eventEmitted(this.datepicker, 'vl-datepicker-created');
          assert.isTrue(this.datepicker._picker.config.locale === "de");

          this.datepicker.removeAttribute('locale');
          await eventEmitted(this.datepicker, 'vl-datepicker-created');
          assert.isTrue(this.datepicker._picker.config.locale === "nl");
        });

    test('kan een vooringestelde datum hebben', async () => {
      const defaultDateObj = new Date(2020, 0, 1);

      this.datepicker.setAttribute('default-date', '01-01-2020');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.defaultDate === '01-01-2020');
      assert.isTrue(
          this.datepicker._picker.selectedDates[0].getTime() === defaultDateObj.getTime());

      this.datepicker.removeAttribute('default-date');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.defaultDate == null);
    });

    test('heeft als default datumformaat d-m-Y (bv. 01-01-2020)', () => {
      assert.isTrue(this.datepicker._picker.config.dateFormat === 'd-m-Y');
    });

    test('kan een custom datumformaat hebben', async () => {
      this.datepicker.setAttribute('format', 'd/m/Y');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.dateFormat === 'd/m/Y');

      this.datepicker.removeAttribute('format');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isFalse(this.datepicker._picker.config.dateFormat === 'd/m/Y');
    });

    test('kan de datum in een human-friendly formaat tonen', async () => {
      this.datepicker.setAttribute('human-format', 'l j F Y');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.altInput);
      assert.isTrue(this.datepicker._picker.config.altFormat === 'l j F Y');

      this.datepicker.removeAttribute('human-format');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isFalse(this.datepicker._picker.config.altInput);
    });

    test('kan een minimum en maximum datum hebben', async () => {
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      this.datepicker.setAttribute('min-date', 'today');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.minDate.getTime() === today.getTime());

      this.datepicker.removeAttribute('min-date');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(typeof this.datepicker._picker.config.minDate === 'undefined');

      this.datepicker.setAttribute('max-date', 'today');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(this.datepicker._picker.config.maxDate.getTime() === today.getTime());

      this.datepicker.removeAttribute('max-date');
      await eventEmitted(this.datepicker, 'vl-datepicker-created');
      assert.isTrue(typeof this.datepicker._picker.config.maxDate === 'undefined');
    });

    test('geeft aan wanneer een waarde verandert', (done) => {
      this.datepicker.addEventListener('change', (e) => {
        done();
      });
      this.datepicker._picker.setDate(new Date(), true);
    });
  });
</script>
</body>
</html>
