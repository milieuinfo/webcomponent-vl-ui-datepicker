<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <script src="../../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>

  <script type="module" src="../../src/vl-input-field.src.js"></script>
  <script src="../../node_modules/sinon/pkg/sinon.js"></script>
</head>

<body>
  <test-fixture id="vl-input-field-fixture">
    <template>
      <input is="vl-input-field" />
    </template>
  </test-fixture>

  <test-fixture id="vl-input-field-inside-form-fixture">
    <template>
      <form>
        <input is="vl-input-field" />
      </form>
    </template>
  </test-fixture>

  <script>
    suite('vl-input-field', () => {
      setup((done) => {
        window.vl = {
          formValidation: {
            dress : sinon.fake()
          }
        }

        customElements.whenDefined('vl-input-field').then(done);
      });

      test('heeft de vl-input-field class', () => {
        const button = fixture('vl-input-field-fixture');
        assert.isTrue(button.classList.contains('vl-input-field'));
      });

      test('krijgt de juiste class wanneer het veld een correct attribuut bevat', () => {
        const field = fixture('vl-input-field-fixture');
        ['block', 'small', 'error', 'success', 'disabled'].forEach((attribuut) => {
          assert.isFalse(field.classList.contains('vl-input-field--' + attribuut));
          field.setAttribute(attribuut, '');
          assert.isTrue(field.classList.contains('vl-input-field--' + attribuut));
          field.removeAttribute(attribuut);
          assert.isFalse(field.classList.contains('vl-input-field--' + attribuut));
        });
      });

      test('krijgt geen class wanneer het veld een onbeschikbaar attribuut bevat', () => {
        const field = fixture('vl-input-field-fixture');
        const attribuut = 'onbeschikbaarattribuut';
        field.setAttribute(attribuut, '');
        assert.isFalse(field.classList.contains('vl-input-field--' + attribuut));
      });

      test('indien het input veld onderdeel is van een formulier zal de validatie geactiveerd worden', () => {
        const field = fixture('vl-input-field-fixture');
        assert(window.vl.formValidation.dress.neverCalledWith());
        const form = fixture('vl-input-field-inside-form-fixture');
        assert(window.vl.formValidation.dress.calledWith(form));
      });

      test('de validatie succes en error class attributen worden correct gezet indien het input veld onderdeel is van een formulier', () => {
        const field = fixture('vl-input-field-fixture');
        const formField = fixture('vl-input-field-inside-form-fixture').querySelector('input');
        ['success', 'error'].forEach((type) => {
          assert.isFalse(field.hasAttribute('data-vl-' + type + '-class'));
          assert.equal(formField.getAttribute('data-vl-' + type + '-class'), 'vl-input-field--' + type);
        });
      });
    });
  </script>
</body>

</html>
