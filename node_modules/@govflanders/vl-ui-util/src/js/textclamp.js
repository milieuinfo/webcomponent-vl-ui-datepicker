import MultiClamp from 'multi-clamp';

const tcAtt = 'data-' + vl.ns + 'clamp';

class Textclamp {
  constructor() {
    this.elementsToClamp;
  }

  // Public functions
  dress(element) {
    let clampSize = parseInt(element.getAttribute(tcAtt), 10);
    const fontsize = Math.round(parseFloat(window.getComputedStyle(element, null).getPropertyValue('font-size')));

    if(/MSIE \d|Trident.*rv:/.test(navigator.userAgent)) { // apply only in IE
      element.setAttribute('style', `font-size:${fontsize}px;`);
    }

    if(clampSize <= 0){
      return;
    }
    new MultiClamp(element, {
      clamp: clampSize
    });
  }

  dressAll() {
    this.elementsToClamp = document.querySelectorAll(`[${tcAtt}]`);

    vl.util.each(this.elementsToClamp, element => {
      this.dress(element);
    });
  }
}

if(!('textclamp' in vl)) {
  vl.textclamp = new Textclamp();
  vl.textclamp.dressAll();
}

export default Textclamp;
