"use strict";!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.MultiClamp=t.MultiClamp||i()}(this,function(){function a(t){return parseInt(t,10)}function s(t){return(t+"").replace(/[^\d.]/g,"")-0}function p(t,i){return"textContent"in t?t.textContent=i:t.innerText=i}function h(t){return"textContent"in t?t.textContent:t.innerText}function l(t,i){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(i):t.currentStyle.getAttribute(i.replace(/-(\w)/g,function(t,i){return i.toUpperCase()}))}function c(t){var i=l(t,"height");return-1<i.indexOf("px")?s(i):s(t.clientHeight)-s(l(t,"padding-top"))-s(l(t,"padding-bottom"))}var t=function(t,i){if(t){this.element=t.length?t[0]:t;var e=i||{};if(this.option={ellipsis:"ellipsis"in e?e.ellipsis:"...",clamp:"clamp"in e?e.clamp:3,reverse:"reverse"in e&&!!e.reverse,splitByWords:"splitByWords"in e&&!!e.splitByWords,disableCssClamp:"disableCssClamp"in e&&!!e.disableCssClamp,onClampStart:"onClampStart"in e&&"function"==typeof e.onClampStart?e.onClampStart:function(){},onClampEnd:"onClampEnd"in e&&"function"==typeof e.onClampEnd?e.onClampEnd:function(){}},"lineTextLen"in e&&(this.option.lineTextLen=e.lineTextLen),"auto"===this.option.clamp)this.autoClamp=!0;else{if(this.option.clamp=a(this.option.clamp),isNaN(this.option.clamp)||this.option.clamp<1)throw new Error("Invaild clamp number!");this.autoClamp=!1}this.useCssClamp=!(this.option.disableCssClamp||this.autoClamp||this.option.reverse||this.option.splitByWords||"..."!==this.option.ellipsis||void 0===document.body.style.webkitLineClamp),this.init(),this.clamp()}};return t.prototype={constructor:t,reload:function(){this.init(),this.clamp()},init:function(){if(this.useCssClamp){var t={display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:this.option.clamp,WebkitBoxOrient:"vertical"};for(var i in t)this.element.style[i]=t[i]}else this.ellipsis=document.createElement("span"),this.ellipsis.style.display="none",this.ellipsis.innerHTML=this.option.ellipsis,this.content=document.createElement("span"),this.wrapper=document.createElement("div"),p(this.content,h(this.element)),this.element.innerHTML="",this.element.appendChild(this.wrapper),this.option.reverse?(this.wrapper.appendChild(this.ellipsis),this.wrapper.appendChild(this.content)):(this.wrapper.appendChild(this.content),this.wrapper.appendChild(this.ellipsis))},getSingleLineHeight:function(){var t=l(this.wrapper,"line-height"),e=this;if(-1<t.indexOf("px"))return s(t);if(isNaN(t))return n();var i=l(this.wrapper,"font-size");return-1<i.indexOf("px")?s(i)*(100*t)/100:-1<i.indexOf("pt")?400*s(i)/300*(100*t)/100:n();function n(){var t=h(e.content);p(e.content,".");var i=c(e.wrapper);return p(e.content,t),i}},clamp:function(){if(!this.useCssClamp){var t,i=this,e=h(this.content),n=c(this.wrapper),s=this.getSingleLineHeight();if(""===e||!n||!s)return r();if(this.autoClamp?(t=c(this.element),this.option.clamp=a(t/s)):t=s*this.option.clamp,!t)return r();if(t<n){var l=this.option.onClampStart.call(this,{needClamp:!0});if(void 0===l||l){this.ellipsis.style.display="";var o=this.option.splitByWords?e.match(/\w+|\W+?/g):e,p=(this.option.lineTextLen||Math.min(20,e.length/this.option.clamp))*this.option.clamp;this.trunkSlice(o,t,p,0,!1),this.option.onClampEnd.call(this,{didClamp:!0})}else r(!0)}else r()}function r(t){t||i.option.onClampStart.call(i,{needClamp:!1}),i.element.innerHTML=h(i.content),i.clean(),i.option.onClampEnd.call(i,{didClamp:!1})}},trunkSlice:function(t,i,e,n,s){var l,o=this.option.reverse?t.slice(t.length-n):t.slice(0,n);if(p(this.content,this.option.splitByWords?o.join(""):o),c(this.wrapper)>i)l=s?e:a(e/2)||1,this.trunkSlice(t,i,l,n-l,!0);else{if(1===e&&s)return this.option.splitByWords&&/\s/.test(o[this.option.reverse?0:o.length-1])&&p(this.content,(this.option.reverse?o.slice(1):o.slice(0,o.length-1)).join("")),this.option.reverse?this.element.innerHTML=this.ellipsis.innerHTML+h(this.content):this.element.innerHTML=h(this.content)+this.ellipsis.innerHTML,void this.clean();l=s?a(e/2)||1:e,this.trunkSlice(t,i,l,n+l,!1)}},clean:function(){this.wrapper=null,this.ellipsis=null,this.content=null,delete this.wrapper,delete this.ellipsis,delete this.content}},t});